/*!
 RowReorder 1.2.0
 2015-2016 SpryMedia Ltd - datatables.net/license
*/
(function(e){"function"===typeof define&&define.amd?define(["jquery","datatables.net"],function(f){return e(f,window,document)}):"object"===typeof exports?module.exports=function(f,h){f||(f=window);if(!h||!h.fn.dataTable)h=require("datatables.net")(f,h).$;return e(h,f,f.document)}:e(jQuery,window,document)})(function(e,f,h,n){var k=e.fn.dataTable,j=function(c,b){if(!k.versionCheck||!k.versionCheck("1.10.8"))throw"DataTables RowReorder requires DataTables 1.10.8 or newer";this.c=e.extend(!0,{},k.defaults.rowReorder,
j.defaults,b);this.s={bodyTop:null,dt:new k.Api(c),getDataFn:k.ext.oApi._fnGetObjectDataFn(this.c.dataSrc),middles:null,scroll:{},scrollInterval:null,setDataFn:k.ext.oApi._fnSetObjectDataFn(this.c.dataSrc),start:{top:0,left:0,offsetTop:0,offsetLeft:0,nodes:[]},windowHeight:0};this.dom={clone:null,dtScroll:e("div.dataTables_scrollBody",this.s.dt.table().container())};var a=this.s.dt.settings()[0],d=a.rowreorder;if(d)return d;a.rowreorder=this;this._constructor()};e.extend(j.prototype,{_constructor:function(){var c=
this,b=this.s.dt,a=e(b.table().node());"static"===a.css("position")&&a.css("position","relative");e(b.table().container()).on("mousedown.rowReorder touchstart.rowReorder",this.c.selector,function(a){if(c.c.enable){var i=e(this).closest("tr"),g=b.row(i);if(g.any())return c._emitEvent("pre-row-reorder",{node:g.node(),index:g.index()}),c._mouseDown(a,i),!1}});b.on("destroy.rowReorder",function(){e(b.table().container()).off(".rowReorder");b.off(".rowReorder")})},_cachePositions:function(){var c=this.s.dt,
b=e(c.table().node()).find("thead").outerHeight(),a=e.unique(c.rows({page:"current"}).nodes().toArray()),d=e.map(a,function(a){return e(a).position().top-b}),a=e.map(d,function(a,b){return d.length<b-1?(a+d[b+1])/2:(a+a+e(c.row(":last-child").node()).outerHeight())/2});this.s.middles=a;this.s.bodyTop=e(c.table().body()).offset().top;this.s.windowHeight=e(f).height()},_clone:function(c){var b=e(this.s.dt.table().node().cloneNode(!1)).addClass("dt-rowReorder-float").append("<tbody/>").append(c.clone(!1)),
a=c.outerWidth(),d=c.outerHeight(),i=c.children().map(function(){return e(this).width()});b.width(a).height(d).find("tr").children().each(function(a){this.style.width=i[a]+"px"});b.appendTo("body");this.dom.clone=b},_clonePosition:function(c){var b=this.s.start,a=this._eventToPage(c,"Y")-b.top,c=this._eventToPage(c,"X")-b.left,d=this.c.snapX;this.dom.clone.css({top:a+b.offsetTop,left:!0===d?b.offsetLeft:"number"===typeof d?b.offsetLeft+d:c+b.offsetLeft})},_emitEvent:function(c,b){this.s.dt.iterator("table",
function(a){e(a.nTable).triggerHandler(c+".dt",b)})},_eventToPage:function(c,b){return-1!==c.type.indexOf("touch")?c.originalEvent.touches[0]["page"+b]:c["page"+b]},_mouseDown:function(c,b){var a=this,d=this.s.dt,i=this.s.start,g=b.offset();i.top=this._eventToPage(c,"Y");i.left=this._eventToPage(c,"X");i.offsetTop=g.top;i.offsetLeft=g.left;i.nodes=e.unique(d.rows({page:"current"}).nodes().toArray());this._cachePositions();this._clone(b);this._clonePosition(c);this.dom.target=b;b.addClass("dt-rowReorder-moving");
e(h).on("mouseup.rowReorder touchend.rowReorder",function(b){a._mouseUp(b)}).on("mousemove.rowReorder touchmove.rowReorder",function(b){a._mouseMove(b)});e(f).width()===e(h).width()&&e(h.body).addClass("dt-rowReorder-noOverflow");d=this.dom.dtScroll;this.s.scroll={windowHeight:e(f).height(),windowWidth:e(f).width(),dtTop:d.length?d.offset().top:null,dtLeft:d.length?d.offset().left:null,dtHeight:d.length?d.outerHeight():null,dtWidth:d.length?d.outerWidth():null}},_mouseMove:function(c){this._clonePosition(c);
for(var b=this._eventToPage(c,"Y")-this.s.bodyTop,a=this.s.middles,d=null,i=this.s.dt,g=i.table().body(),l=0,h=a.length;l<h;l++)if(b<a[l]){d=l;break}null===d&&(d=a.length);if(null===this.s.lastInsert||this.s.lastInsert!==d)0===d?this.dom.target.prependTo(g):(b=e.unique(i.rows({page:"current"}).nodes().toArray()),d>this.s.lastInsert?this.dom.target.insertAfter(b[d-1]):this.dom.target.insertBefore(b[d])),this._cachePositions(),this.s.lastInsert=d;this._shiftScroll(c)},_mouseUp:function(){var c=this,
b=this.s.dt,a,d,i=this.c.dataSrc;this.dom.clone.remove();this.dom.clone=null;this.dom.target.removeClass("dt-rowReorder-moving");e(h).off(".rowReorder");e(h.body).removeClass("dt-rowReorder-noOverflow");clearInterval(this.s.scrollInterval);this.s.scrollInterval=null;var g=this.s.start.nodes,l=e.unique(b.rows({page:"current"}).nodes().toArray()),f={},j=[],k=[],m=this.s.getDataFn,n=this.s.setDataFn;a=0;for(d=g.length;a<d;a++)if(g[a]!==l[a]){var o=b.row(l[a]).id(),q=b.row(l[a]).data(),p=b.row(g[a]).data();
o&&(f[o]=m(p));j.push({node:l[a],oldData:m(q),newData:m(p),newPosition:a,oldPosition:e.inArray(l[a],g)});k.push(l[a])}g=[j,{dataSrc:i,nodes:k,values:f,triggerRow:b.row(this.dom.target)}];this._emitEvent("row-reorder",g);this.c.editor&&(this.c.enable=!1,this.c.editor.edit(k,!1,e.extend({submit:"changed"},this.c.formOptions)).multiSet(i,f).one("submitComplete",function(){c.c.enable=!0}).submit());if(this.c.update){a=0;for(d=j.length;a<d;a++)f=b.row(j[a].node).data(),n(f,j[a].newData),b.columns().every(function(){this.dataSrc()===
i&&b.cell(j[a].node,this.index()).invalidate("data")});this._emitEvent("row-reordered",g);b.draw(!1)}},_shiftScroll:function(c){var b=this,a=this.s.scroll,d=!1,e=c.pageY-h.body.scrollTop,g,f;65>e?g=-5:e>a.windowHeight-65&&(g=5);null!==a.dtTop&&c.pageY<a.dtTop+65?f=-5:null!==a.dtTop&&c.pageY>a.dtTop+a.dtHeight-65&&(f=5);g||f?(a.windowVert=g,a.dtVert=f,d=!0):this.s.scrollInterval&&(clearInterval(this.s.scrollInterval),this.s.scrollInterval=null);!this.s.scrollInterval&&d&&(this.s.scrollInterval=setInterval(function(){if(a.windowVert)h.body.scrollTop=
h.body.scrollTop+a.windowVert;if(a.dtVert){var c=b.dom.dtScroll[0];if(a.dtVert)c.scrollTop=c.scrollTop+a.dtVert}},20))}});j.defaults={dataSrc:0,editor:null,enable:!0,formOptions:{},selector:"td:first-child",snapX:!1,update:!0};var m=e.fn.dataTable.Api;m.register("rowReorder()",function(){return this});m.register("rowReorder.enable()",function(c){c===n&&(c=!0);return this.iterator("table",function(b){b.rowreorder&&(b.rowreorder.c.enable=c)})});m.register("rowReorder.disable()",function(){return this.iterator("table",
function(c){c.rowreorder&&(c.rowreorder.c.enable=!1)})});j.version="1.2.0";e.fn.dataTable.RowReorder=j;e.fn.DataTable.RowReorder=j;e(h).on("init.dt.dtr",function(c,b){if("dt"===c.namespace){var a=b.oInit.rowReorder,d=k.defaults.rowReorder;if(a||d)d=e.extend({},a,d),!1!==a&&new j(b,d)}});return j});
