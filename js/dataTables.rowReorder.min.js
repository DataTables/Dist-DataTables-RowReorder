/*!
 RowReorder 1.1.0-dev
 2015 SpryMedia Ltd - datatables.net/license
*/
(function(e){"function"===typeof define&&define.amd?define(["jquery","datatables.net"],e):"object"===typeof exports?module.exports=function(f){f||(f=require("jquery"));f.fn.dataTable||require("datatables.net")(f);e(f)}:e(jQuery)})(function(e){var f=e.fn.dataTable,h=function(b,a){if(!f.versionCheck||!f.versionCheck("1.10.8"))throw"DataTables RowReorder requires DataTables 1.10.8 or newer";this.c=e.extend(!0,{},f.defaults.rowReorder,h.defaults,a);this.s={bodyTop:null,dt:new f.Api(b),getDataFn:f.ext.oApi._fnGetObjectDataFn(this.c.dataSrc),
middles:null,setDataFn:f.ext.oApi._fnSetObjectDataFn(this.c.dataSrc),start:{top:0,left:0,offsetTop:0,offsetLeft:0,nodes:[]},windowHeight:0};this.dom={clone:null};var d=this.s.dt.settings()[0],c=d.rowreorder;if(c)return c;d.rowreorder=this;this._constructor()};e.extend(h.prototype,{_constructor:function(){var b=this,a=this.s.dt,d=e(a.table().node());"static"===d.css("position")&&d.css("position","relative");e(a.table().container()).on("mousedown.rowReorder touchstart.rowReorder",this.c.selector,function(c){var d=
e(this).closest("tr");if(a.row(d).any())return b._mouseDown(c,d),!1});a.on("destroy.rowReorder",function(){e(a.table().container()).off(".rowReorder");a.off(".rowReorder")})},_cachePositions:function(){var b=this.s.dt,a=e(b.table().node()).find("thead").outerHeight(),d=e.unique(b.rows({page:"current"}).nodes().toArray()),c=e.map(d,function(b){return e(b).position().top-a}),d=e.map(c,function(a,d){return c.length<d-1?(a+c[d+1])/2:(a+a+e(b.row(":last-child").node()).outerHeight())/2});this.s.middles=
d;this.s.bodyTop=e(b.table().body()).offset().top;this.s.windowHeight=e(window).height()},_clone:function(b){var a=e(this.s.dt.table().node().cloneNode(!1)).addClass("dt-rowReorder-float").append("<tbody/>").append(b.clone(!1)),d=b.outerWidth(),c=b.outerHeight(),g=b.children().map(function(){return e(this).width()});a.width(d).height(c).find("tr").children().each(function(a){this.style.width=g[a]+"px"});a.appendTo("body");this.dom.clone=a},_clonePosition:function(b){var a=this.s.start,d=this._eventToPage(b,
"Y")-a.top,b=this._eventToPage(b,"X")-a.left,c=this.c.snapX;this.dom.clone.css({top:d+a.offsetTop,left:!0===c?a.offsetLeft:"number"===typeof c?a.offsetLeft+c:b+a.offsetLeft})},_emitEvent:function(b,a){this.s.dt.iterator("table",function(d){e(d.nTable).triggerHandler(b+".dt",a)})},_eventToPage:function(b,a){return-1!==b.type.indexOf("touch")?b.originalEvent.touches[0]["page"+a]:b["page"+a]},_mouseDown:function(b,a){var d=this,c=this.s.dt,g=this.s.start,f=a.offset();g.top=this._eventToPage(b,"Y");g.left=
this._eventToPage(b,"X");g.offsetTop=f.top;g.offsetLeft=f.left;g.nodes=e.unique(c.rows({page:"current"}).nodes().toArray());this._cachePositions();this._clone(a);this._clonePosition(b);this.dom.target=a;a.addClass("dt-rowReorder-moving");e(document).on("mouseup.rowReorder touchend.rowReorder",function(a){d._mouseUp(a)}).on("mousemove.rowReorder touchmove.rowReorder",function(a){d._mouseMove(a)});e(window).width()===e(document).width()&&e(document.body).addClass("dt-rowReorder-noOverflow")},_mouseMove:function(b){this._clonePosition(b);
for(var a=this._eventToPage(b,"Y")-this.s.bodyTop,d=this.s.middles,c=null,g=this.s.dt,f=g.table().body(),i=0,h=d.length;i<h;i++)if(a<d[i]){c=i;break}null===c&&(c=d.length);if(null===this.s.lastInsert||this.s.lastInsert!==c)0===c?this.dom.target.prependTo(f):(a=e.unique(g.rows({page:"current"}).nodes().toArray()),c>this.s.lastInsert?this.dom.target.before(a[c-1]):this.dom.target.after(a[c])),this._cachePositions(),this.s.lastInsert=c;b=this._eventToPage(b,"Y")-document.body.scrollTop;c=this.s.scrollInterval;
65>b?c||(this.s.scrollInterval=setInterval(function(){document.body.scrollTop=document.body.scrollTop-5},15)):65>this.s.windowHeight-b?c||(this.s.scrollInterval=setInterval(function(){document.body.scrollTop=document.body.scrollTop+5},15)):(clearInterval(c),this.s.scrollInterval=null)},_mouseUp:function(){var b=this.s.dt,a,d;this.dom.clone.remove();this.dom.clone=null;this.dom.target.removeClass("dt-rowReorder-moving");e(document).off(".rowReorder");e(document.body).removeClass("dt-rowReorder-noOverflow");
clearInterval(this.s.scrollInterval);this.s.scrollInterval=null;var c=this.s.start.nodes,g=e.unique(b.rows({page:"current"}).nodes().toArray()),f={},h=[],j=[],k=this.s.getDataFn,n=this.s.setDataFn;a=0;for(d=c.length;a<d;a++)if(c[a]!==g[a]){var l=b.row(g[a]).id(),o=b.row(g[a]).data(),m=b.row(c[a]).data();l&&(f[l]=k(m));h.push({node:g[a],oldData:k(o),newData:k(m),newPosition:a,oldPosition:e.inArray(g[a],c)});j.push(g[a])}this._emitEvent("row-reorder",[h,{dataSrc:this.c.dataSrc,nodes:j,values:f}]);this.c.editor&&
this.c.editor.edit(j,!1,{submit:"changed"}).multiSet(this.c.dataSrc,f).submit();if(this.c.update){a=0;for(d=h.length;a<d;a++)c=b.row(h[a].node),g=c.data(),n(g,h[a].newData),c.invalidate("data");b.draw(!1)}}});h.defaults={dataSrc:0,editor:null,selector:"td:first-child",snapX:!1,update:!0};h.version="1.1.0-dev";e.fn.dataTable.RowReorder=h;e.fn.DataTable.RowReorder=h;e(document).on("init.dt.dtr",function(b,a){if("dt"===b.namespace){var d=a.oInit.rowReorder,c=f.defaults.rowReorder;if(d||c)c=e.extend({},
d,c),!1!==d&&new h(a,c)}});return h});
